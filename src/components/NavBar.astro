---
import siteConfig from '../../site.config.mjs';

const title = siteConfig.title;

const base = import.meta.env.BASE_URL || '/';
const cleanBase = base === '/' ? '' : base.replace(/\/$/, '');
const buildLink = (path: string) => {
	if (!path) return cleanBase || '/';
	return cleanBase ? `${cleanBase}/${path}` : `/${path}`;
};

const menuItems = [
	{ name: 'Localisation', link: buildLink('localisation') },
	{ name: 'Intérieurs', link: buildLink('description') },
	{ name: 'Extérieurs', link: buildLink('les-exterieurs') },
	{ name: 'Points clés', link: buildLink('les-points-forts-faibles') },
	{ name: 'Vidéo', link: buildLink('video') },
	{ name: 'Contact', link: buildLink('contact') },
];
---

<nav class="nav-modern">
	<div class="container-modern">
		<a href={base} class="nav-logo">{title}</a>
		
		<!-- Desktop Navigation -->
		<ul class="nav-links nav-desktop">
			{menuItems.map((item) => (
				<li><a href={item.link}>{item.name}</a></li>
			))}
		</ul>
		
		<!-- Mobile Hamburger Button -->
		<button class="nav-hamburger" aria-label="Menu" aria-expanded="false">
			<span class="hamburger-line"></span>
			<span class="hamburger-line"></span>
			<span class="hamburger-line"></span>
		</button>
		
		<!-- Mobile Navigation Overlay -->
		<div class="nav-mobile-overlay"></div>
		
		<!-- Mobile Navigation Menu -->
		<div class="nav-mobile">
			<ul class="nav-mobile-links">
				{menuItems.map((item, index) => (
					<li style={`--delay: ${index * 0.05}s`}><a href={item.link}>{item.name}</a></li>
				))}
			</ul>
		</div>
	</div>
</nav>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const hamburger = document.querySelector('.nav-hamburger');
		const mobileNav = document.querySelector('.nav-mobile');
		const overlay = document.querySelector('.nav-mobile-overlay');
		const body = document.body;

		const toggleMenu = () => {
			const isOpen = hamburger?.classList.toggle('active');
			mobileNav?.classList.toggle('active');
			overlay?.classList.toggle('active');
			body.style.overflow = isOpen ? 'hidden' : '';
			hamburger?.setAttribute('aria-expanded', String(isOpen));
		};

		hamburger?.addEventListener('click', toggleMenu);
		overlay?.addEventListener('click', toggleMenu);

		// Close menu on link click
		document.querySelectorAll('.nav-mobile-links a').forEach(link => {
			link.addEventListener('click', () => {
				if (mobileNav?.classList.contains('active')) {
					toggleMenu();
				}
			});
		});

		// Close on escape key
		document.addEventListener('keydown', (e) => {
			if (e.key === 'Escape' && mobileNav?.classList.contains('active')) {
				toggleMenu();
			}
		});
	});
</script>
